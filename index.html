<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>臺北市運動場館地圖</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* 左側篩選面板 */
        .sidebar-left {
            width: 280px;
            background: #fff;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            padding: 20px;
            z-index: 1000;
        }

        .sidebar-left h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #333;
        }

        .filter-section {
            margin-bottom: 25px;
        }

        .filter-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }

        .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .filter-option input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }

        .filter-option label {
            cursor: pointer;
            font-size: 14px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            width: 100%;
            margin-top: 8px;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .radius-slider {
            width: 100%;
            margin-top: 10px;
        }

        .radius-value {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        /* 中間地圖 */
        .map-container {
            flex: 1;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* 上方搜尋框 */
        .search-bar {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 400px;
            max-width: 90%;
        }

        .search-input-container {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 5px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: none;
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .search-result-item:hover {
            background: #f5f5f5;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        /* 右側結果列表 */
        .sidebar-right {
            width: 320px;
            background: #fff;
            border-left: 1px solid #ddd;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-right.collapsed {
            width: 0;
            overflow: hidden;
        }

        .results-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-count {
            font-size: 14px;
            color: #666;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #666;
        }

        .venue-list {
            padding: 10px;
        }

        .venue-item {
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .venue-item:hover {
            background: #f9f9f9;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .venue-item.selected {
            border-color: #2196F3;
            background: #E3F2FD;
        }

        .venue-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
            color: #333;
        }

        .venue-type {
            font-size: 12px;
            color: #2196F3;
            margin-bottom: 3px;
        }

        .venue-address {
            font-size: 12px;
            color: #666;
            margin-bottom: 3px;
        }

        .venue-distance {
            font-size: 12px;
            color: #FF9800;
            font-weight: 500;
        }

        /* 詳情面板 */
        .detail-panel {
            position: absolute;
            right: 340px;
            top: 50%;
            transform: translateY(-50%);
            width: 350px;
            max-height: 80vh;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 1001;
            overflow-y: auto;
            display: none;
        }

        .detail-panel.show {
            display: block;
        }

        .detail-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            position: relative;
        }

        .detail-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .detail-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
            padding-right: 30px;
        }

        .detail-type {
            font-size: 14px;
            color: #2196F3;
        }

        .detail-body {
            padding: 20px;
        }

        .detail-item {
            margin-bottom: 15px;
        }

        .detail-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 3px;
        }

        .detail-value {
            font-size: 14px;
            color: #333;
        }

        .detail-action {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }

        .detail-action a {
            color: #2196F3;
            text-decoration: none;
            font-size: 13px;
        }

        .detail-action a:hover {
            text-decoration: underline;
        }

        /* 自訂 marker */
        .custom-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        /* 高亮閃爍動畫 */
        @keyframes highlight-pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            }
            25% {
                transform: scale(1.5);
                box-shadow: 0 0 20px rgba(255, 193, 7, 0.8), 0 0 40px rgba(255, 193, 7, 0.6);
            }
            50% {
                transform: scale(1.3);
                box-shadow: 0 0 30px rgba(255, 193, 7, 1), 0 0 50px rgba(255, 193, 7, 0.8);
            }
            75% {
                transform: scale(1.5);
                box-shadow: 0 0 20px rgba(255, 193, 7, 0.8), 0 0 40px rgba(255, 193, 7, 0.6);
            }
        }

        .custom-marker.highlight {
            animation: highlight-pulse 2s ease-in-out;
            z-index: 10000 !important;
        }

        .marker-dumbbell { background: #FF5722; }
        .marker-yoga { background: #9C27B0; }
        .marker-swimming { background: #2196F3; }
        .marker-swimming-indoor { background: #1976D2; }
        .marker-swimming-outdoor { background: #03A9F4; }
        .marker-swimming-both { background: #00BCD4; }
        .marker-sports { background: #4CAF50; }
        .marker-default { background: #757575; }

        /* Tooltip 樣式 */
        .custom-tooltip {
            background: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .tooltip-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .tooltip-type {
            font-size: 12px;
            color: #2196F3;
            margin-bottom: 3px;
        }

        .tooltip-address {
            font-size: 12px;
            color: #666;
        }

        /* 地圖浮動定位按鈕 */
        .map-locate-btn {
            position: absolute;
            bottom: 120px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: white;
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #2196F3;
            transition: all 0.2s;
        }

        .map-locate-btn:hover {
            background: #f5f5f5;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transform: scale(1.05);
        }

        .map-locate-btn:active {
            transform: scale(0.95);
        }

        .map-locate-btn.locating {
            color: #FF9800;
        }

        .map-locate-btn.located {
            color: #4CAF50;
        }

        /* 載入中 */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 2000;
        }

        .loading.hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .sidebar-left {
                position: absolute;
                left: -280px;
                transition: left 0.3s;
                z-index: 1100;
            }

            .sidebar-left.show {
                left: 0;
            }

            .sidebar-right {
                position: absolute;
                right: -320px;
                transition: right 0.3s;
                z-index: 1100;
            }

            .sidebar-right.show {
                right: 0;
            }

            .detail-panel {
                right: 10px;
                left: 10px;
                width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="loading">
        <i class="fas fa-spinner fa-spin fa-3x"></i>
        <p>載入中...</p>
    </div>

    <div class="container">
        <!-- 左側篩選面板 -->
        <div class="sidebar-left">
            <h2>臺北市運動場館</h2>

            <div class="filter-section">
                <h3>場館類型</h3>
                <div class="filter-option">
                    <input type="checkbox" id="filter-all" checked>
                    <label for="filter-all">全選</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filter-gym" class="venue-filter" data-type="健身房" checked>
                    <label for="filter-gym">健身房</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filter-yoga" class="venue-filter" data-type="瑜珈教室" checked>
                    <label for="filter-yoga">瑜珈教室</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filter-pool" class="venue-filter" data-type="游泳池" checked>
                    <label for="filter-pool">游泳池（所有）</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filter-sports" class="venue-filter" data-type="撞球場及攀岩場" checked>
                    <label for="filter-sports">撞球場及攀岩場</label>
                </div>
            </div>

            <div class="filter-section">
                <button class="btn btn-primary" id="locate-btn">
                    <i class="fas fa-location-arrow"></i> 定位我
                </button>
                <button class="btn btn-secondary" id="taipei-station-btn">
                    <i class="fas fa-train"></i> 臺北車站
                </button>
            </div>

            <div class="filter-section" id="radius-section" style="display: none;">
                <h3>附近範圍</h3>
                <input type="range" class="radius-slider" id="radius-slider" min="0.5" max="5" step="0.5" value="2">
                <div class="radius-value">半徑：<span id="radius-value">2</span> 公里</div>
            </div>
        </div>

        <!-- 中間地圖 -->
        <div class="map-container">
            <!-- 搜尋框 -->
            <div class="search-bar">
                <div class="search-input-container">
                    <input type="text" class="search-input" id="search-input" placeholder="搜尋場館名稱、地址或行政區...">
                    <i class="fas fa-search search-icon"></i>
                    <div class="search-results" id="search-results"></div>
                </div>
            </div>

            <!-- 地圖 -->
            <div id="map"></div>

            <!-- 浮動定位按鈕 -->
            <button class="map-locate-btn" id="map-locate-btn" title="定位我">
                <i class="fas fa-location-crosshairs"></i>
            </button>
        </div>

        <!-- 右側結果列表 -->
        <div class="sidebar-right">
            <div class="results-header">
                <div class="results-count" id="results-count">共 0 個場館</div>
                <button class="toggle-sidebar" id="toggle-sidebar">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="venue-list" id="venue-list"></div>
        </div>
    </div>

    <!-- 詳情面板 -->
    <div class="detail-panel" id="detail-panel">
        <div class="detail-header">
            <button class="detail-close" id="detail-close">&times;</button>
            <div class="detail-title" id="detail-title"></div>
            <div class="detail-type" id="detail-type"></div>
        </div>
        <div class="detail-body" id="detail-body"></div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Leaflet MarkerCluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <!-- App JS -->
    <script src="app.js"></script>
</body>
</html>
